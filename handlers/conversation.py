"""
Advanced AI Conversation Handler - Professional Language Learning
Intelligent AI suhbat tizimi - Professional til o'rganish
"""

from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
import asyncio
import random

from config import ADMIN_ID
from database import get_user, is_premium_active
from keyboards import get_main_menu, get_grammar_ai_menu
from utils.rating_system import update_user_rating
from utils.ai_conversation import get_ai_response

router = Router()

class ConversationStates(StatesGroup):
    korean_chat = State()
    japanese_chat = State()
    korean_grammar = State()
    japanese_grammar = State()

# Kores so'zlari va iboralar lug'ati - 6000+ javob
KOREAN_RESPONSES = {
    # Salomlashish va tanishuv
    "안녕하세요": ["안녕하세요! 어떻게 지내세요?", "안녕하세요! 오늘 뭐 하세요?", "안녕하세요! 반갑습니다!", "안녕하세요! 날씨가 좋네요!", "안녕하세요! 기분이 어때요?", "안녕하세요! 한국어 공부 어때요?", "안녕하세요! 오늘도 화이팅!", "안녕하세요! 좋은 하루 보내세요!", "안녕하세요! 뭔가 새로운 거 배웠어요?", "안녕하세요! 한국 문화 좋아해요?"],
    "안녕": ["안녕! 잘 지내?", "안녕! 뭐해?", "안녕! 반가워!", "안녕! 오늘 어때?", "안녕! 공부해?", "안녕! 한국어 재밌어?", "안녕! 뭔가 먹었어?", "안녕! 드라마 봐?", "안녕! 음악 들어?", "안녕! 친구야!"],
    "hello": ["안녕하세요! (annyeonghaseyo)", "안녕! (annyeong)", "반갑습니다! (bangapseumnida)", "하이! (hai)", "헬로! (hello)", "좋은 아침! (joeun achim)", "좋은 저녁! (joeun jeonyeok)"],
    "hi": ["안녕하세요!", "안녕!", "하이!", "헬로!", "반가워요!", "어서와!", "좋아요!"],
    
    # 이름과 소개
    "이름": ["제 이름은 한국어 선생님이에요", "저는 한국어 봇입니다", "한국어를 가르치는 봇이에요", "한국어 도우미예요", "저는 여러분의 한국어 친구예요", "한국어 공부를 도와주는 AI예요"],
    "누구": ["저는 한국어 선생님이에요", "한국어를 가르치는 봇이에요", "여러분의 한국어 친구예요", "한국어 공부 도우미예요"],
    "뭐해": ["한국어를 가르치고 있어요", "학생들과 대화하고 있어요", "한국어 공부를 도와주고 있어요", "여러분과 이야기하고 있어요", "한국어 연습을 도와드려요", "재미있는 대화를 하고 있어요"],
    
    # 감사와 사과
    "고마워": ["천만에요!", "별말씀을요!", "도움이 되어서 기뻐요!", "제가 더 고마워요!", "언제든지요!", "기꺼이 도와드려요!", "당연한 거예요!", "별거 아니에요!"],
    "감사합니다": ["천만에요!", "별말씀을요!", "제가 더 감사해요!", "도움이 되어서 기뻐요!", "언제든지 말씀하세요!", "기꺼이 도와드릴게요!"],
    "고맙다": ["천만에! 별거 아니야!", "당연하지!", "언제든지!", "기꺼이!"],
    "미안": ["괜찮아요!", "신경 쓰지 마세요!", "별거 아니에요!", "이해해요!", "문제없어요!"],
    "죄송": ["괜찮습니다!", "신경 쓰지 마세요!", "별말씀을요!", "이해합니다!"],
    
    # 학습 관련
    "공부": ["한국어 공부 화이팅!", "열심히 공부하세요!", "공부하는 모습이 멋져요!", "한국어 실력이 늘 거예요!", "매일 조금씩이라도 공부해요!", "공부가 제일 중요해요!", "한국어 마스터가 될 거예요!", "포기하지 마세요!", "꾸준히 하는 게 비결이에요!"],
    "어려워": ["괜찮아요, 천천히 해요", "처음엔 다 어려워요", "조금씩 늘어날 거예요", "포기하지 마세요!", "연습하면 쉬워져요!", "시간이 해결해 줄 거예요!", "모든 언어가 처음엔 어려워요!", "한 걸음씩 가요!"],
    "쉬워": ["잘하고 있어요!", "대단해요!", "계속 화이팅!", "실력이 늘었네요!", "정말 빨리 배우시네요!", "천재인가 봐요!", "멋져요!", "계속 이런 식으로!"],
    "배우고": ["배우는 자세가 멋져요!", "계속 배워나가요!", "매일 새로운 걸 배워요!", "배움에는 끝이 없어요!"],
    "연습": ["연습이 최고예요!", "매일 연습해요!", "연습하면 늘어요!", "꾸준한 연습이 비결이에요!"],
    
    # 일상 대화
    "먹어": ["뭐 먹었어요?", "맛있게 드세요!", "한국 음식 좋아해요?", "배고파요?", "맛있는 거 드세요!", "건강한 음식 드세요!"],
    "맛있어": ["한국 음식 좋아해요?", "뭐가 제일 맛있어요?", "김치 먹어봤어요?", "불고기 어때요?", "비빔밥 좋아해요?", "떡볶이는 어때요?"],
    "배고파": ["뭐 먹고 싶어요?", "맛있는 거 드세요!", "한국 음식 어때요?", "식사 시간이네요!"],
    "자요": ["잘 자요!", "좋은 꿈 꿔요!", "내일 봐요!", "푹 쉬세요!", "안녕히 주무세요!"],
    "잠": ["잠이 와요?", "일찍 자세요!", "충분히 주무세요!", "수면이 중요해요!"],
    
    # 감정 표현
    "사랑해": ["한국어를 사랑해 주셔서 감사해요!", "저도 한국어를 사랑해요!", "사랑은 아름다워요!", "사랑해요도 한국어로 해요!", "한국 문화도 사랑해 주세요!"],
    "좋아": ["저도 좋아해요!", "뭘 좋아해요?", "좋은 취향이네요!", "한국 것도 좋아해 주세요!"],
    "싫어": ["왜 싫어해요?", "괜찮아요, 취향이 다를 수 있어요!", "다른 걸 해볼까요?"],
    "기뻐": ["저도 기뻐요!", "좋은 일이 있나 봐요!", "기쁜 마음이 전해져요!", "행복해 보여요!"],
    "슬퍼": ["왜 슬퍼요?", "괜찮아질 거예요!", "힘내세요!", "같이 이겨내요!"],
    "화나": ["진정하세요!", "왜 화났어요?", "화내지 마세요!", "괜찮아질 거예요!"],
    "재미있어": ["한국어가 재미있죠?", "더 재미있게 공부해요!", "재미있는 게 최고예요!", "즐기면서 배워요!", "한국 드라마도 재미있어요!", "한국 음악도 들어보세요!"],
    
    # 날씨와 시간
    "날씨": ["오늘 날씨 어때요?", "날씨가 좋네요!", "비 와요?", "덥나요?", "춥나요?", "맑은 날이에요!"],
    "더워": ["정말 덥네요!", "에어컨 켜세요!", "시원한 거 드세요!", "여름이에요!"],
    "추워": ["정말 춥네요!", "따뜻하게 입으세요!", "히터 켜세요!", "겨울이에요!"],
    "비": ["비 와요!", "우산 가져가세요!", "집에 있어요!", "비 소리 좋아요!"],
    "아침": ["좋은 아침이에요!", "일찍 일어났네요!", "아침 먹었어요?", "좋은 하루 되세요!"],
    "저녁": ["좋은 저녁이에요!", "저녁 먹었어요?", "하루 수고했어요!", "편안한 저녁 되세요!"],
    
    # 한국 문화
    "한국": ["한국 좋아해요?", "한국어 배우는 이유가 뭐예요?", "한국 문화 어때요?", "한국 드라마 봐요?", "한국 음악 들어요?", "한국 음식 먹어봤어요?"],
    "드라마": ["한국 드라마 좋아해요?", "뭔 드라마 봐요?", "로맨스 드라마 어때요?", "사극 좋아해요?"],
    "음악": ["한국 음악 좋아해요?", "K-pop 들어요?", "어떤 가수 좋아해요?", "발라드 좋아해요?"],
    "케이팝": ["K-pop 좋아해요!", "어떤 그룹 좋아해요?", "한국어 가사 이해해요?", "콘서트 가봤어요?"],
    
    # 질문과 대답
    "왜": ["궁금한 게 있나요?", "이유가 있을 거예요!", "설명해 드릴게요!", "질문이 좋아요!"],
    "어디": ["어디가 궁금해요?", "한국 어디 가고 싶어요?", "위치를 말해주세요!"],
    "언제": ["언제인지 궁금하네요!", "시간이 중요해요!", "언제든지 괜찮아요!"],
    "뭐": ["뭔가 궁금한 게 있나요?", "무엇이든 물어보세요!", "뭐든지 도와드릴게요!"],
    "어떻게": ["어떻게 하는지 궁금하네요!", "방법을 알려드릴게요!", "천천히 설명해 드릴게요!"],
    
    # 숫자와 시간
    "하나": ["하나부터 시작해요!", "하나씩 배워요!", "일(1)이라고도 해요!"],
    "둘": ["둘은 이(2)예요!", "두 개예요!", "둘이서 공부해요!"],
    "셋": ["셋은 삼(3)이에요!", "세 개예요!", "셋까지 세어보세요!"],
    "시간": ["지금 몇 시예요?", "시간이 빨라요!", "시간 관리가 중요해요!", "한국 시간으로 말해요!"],
    
    # 가족과 친구
    "가족": ["가족이 몇 명이에요?", "가족 사랑해요?", "가족이 소중해요!", "한국어로 가족 이름 배워요!"],
    "엄마": ["어머니는 어머님이라고도 해요!", "엄마 사랑해요!", "어머니께 안부 전해주세요!"],
    "아빠": ["아버지는 아버님이라고도 해요!", "아빠 사랑해요!", "아버지께 안부 전해주세요!"],
    "친구": ["친구가 많아요?", "좋은 친구가 있나요?", "친구는 소중해요!", "한국 친구도 사귀세요!"],
    
    # 색깔
    "빨간": ["빨간색 좋아해요?", "빨갛다고도 해요!", "사과가 빨개요!"],
    "파란": ["파란색 예뻐요!", "파랗다고도 해요!", "하늘이 파래요!"],
    "노란": ["노란색 밝아요!", "노랗다고도 해요!", "바나나가 노래요!"],
    
    # 동물
    "강아지": ["강아지 귀여워요!", "개라고도 해요!", "멍멍 소리 내요!"],
    "고양이": ["고양이 예뻐요!", "냥이라고도 해요!", "야옹 소리 내요!"],
    
    # 계절
    "봄": ["봄이 좋아요!", "꽃이 피어요!", "따뜻해져요!", "새 학기예요!"],
    "여름": ["여름이 더워요!", "바다 가고 싶어요!", "휴가철이에요!", "아이스크림 먹어요!"],
    "가을": ["가을이 시원해요!", "단풍이 예뻐요!", "수확의 계절이에요!", "선선해져요!"],
    "겨울": ["겨울이 추워요!", "눈이 와요!", "따뜻하게 입어요!", "스키 타러 가요!"],
    
    # 운동과 취미
    "운동": ["운동 좋아해요?", "건강해져요!", "매일 운동해요!", "뭔 운동 해요?"],
    "축구": ["축구 좋아해요?", "한국 축구팀 어때요?", "축구 잘해요?"],
    "농구": ["농구 좋아해요?", "키가 크면 좋겠어요!", "농구 잘해요?"],
    
    # 직업과 학교
    "학생": ["학생이에요?", "공부 열심히 해요!", "어떤 공부 해요?", "학교 재밌어요?"],
    "선생님": ["선생님이세요?", "존경해요!", "가르치는 일 어때요?", "학생들이 좋아해요?"],
    "회사": ["회사 다녀요?", "직장인이에요?", "일이 힘들어요?", "회사 어때요?"],
    
    # 쇼핑과 돈
    "돈": ["돈이 필요해요?", "한국 돈은 원이에요!", "돈 관리 잘해요!", "저축해요!"],
    "쇼핑": ["쇼핑 좋아해요?", "뭐 사고 싶어요?", "한국 쇼핑몰 가봤어요?", "온라인 쇼핑해요?"],
    
    # 여행
    "여행": ["여행 좋아해요?", "한국 여행 어때요?", "어디 가고 싶어요?", "여행 계획 있어요?"],
    "서울": ["서울 가봤어요?", "서울 어때요?", "한국의 수도예요!", "서울타워 가봤어요?"],
    "부산": ["부산 좋아요!", "바다가 예뻐요!", "부산 사투리 들어봤어요?"],
    
    # 기본 동사들
    "가다": ["어디 가요?", "같이 가요!", "가고 싶어요!", "갔다 와요!"],
    "오다": ["어디서 와요?", "오세요!", "왔어요!", "오고 있어요!"],
    "보다": ["뭐 봐요?", "보고 싶어요!", "봤어요!", "보러 가요!"],
    "듣다": ["뭐 들어요?", "듣고 싶어요!", "들었어요!", "잘 들려요!"],
    "말하다": ["뭐라고 말해요?", "말해 주세요!", "말하기 어려워요!", "잘 말했어요!"],
    
    # 인사말 확장
    "잘가": ["안녕히 가세요!", "조심히 가요!", "또 봐요!", "잘가요!"],
    "또봐": ["또 만나요!", "다음에 봐요!", "또 뵈어요!", "또 만날게요!"],
    "안녕히": ["안녕히 가세요!", "안녕히 계세요!", "잘 가요!", "조심히 가요!"],
    
    # 자주 쓰이는 부사들
    "정말": ["정말요?", "정말 좋아요!", "정말 대단해요!", "정말 맞아요!"],
    "너무": ["너무 좋아요!", "너무 예뻐요!", "너무 맛있어요!", "너무 재밌어요!"],
    "아주": ["아주 좋아요!", "아주 많이!", "아주 빨라요!", "아주 예뻐요!"],
    "많이": ["많이 드세요!", "많이 배워요!", "많이 연습해요!", "많이 사랑해요!"],
    
    # Ko'proq so'zlar va iboralar
    "물": ["물 많이 마셔요!", "물이 필요해요?", "건강을 위해 물 드세요!", "깨끗한 물 마셔요!"],
    "커피": ["커피 좋아해요?", "아메리카노 드셔요?", "카페에서 만나요!", "커피 향이 좋네요!"],
    "차": ["차 마실래요?", "녹차 어때요?", "전통차 좋아해요?", "따뜻한 차 드세요!"],
    "책": ["책 읽어요?", "어떤 책 좋아해요?", "한국 소설 읽어봤어요?", "도서관 가요!"],
    "영화": ["영화 봐요?", "한국 영화 어때요?", "어떤 장르 좋아해요?", "영화관 가요!"],
    "게임": ["게임 해요?", "한국 게임 알아요?", "모바일 게임 해요?", "게임 재밌어요!"],
    "컴퓨터": ["컴퓨터 잘 다뤄요?", "프로그래밍 해요?", "인터넷 많이 써요?", "디지털 세대네요!"],
    "핸드폰": ["스마트폰 써요?", "어떤 브랜드 써요?", "핸드폰 없으면 불편하죠?", "앱 많이 써요?"],
    "인터넷": ["인터넷으로 뭐 해요?", "온라인 수업 들어요?", "유튜브 봐요?", "SNS 해요?"],
    "요리": ["요리 할 줄 알아요?", "한국 요리 만들어봤어요?", "요리 배우고 싶어요?", "맛있게 요리해요!"],
    "집": ["집이 어디예요?", "집에서 뭐 해요?", "가족과 살아요?", "집이 편해요?"],
    "방": ["방이 넓어요?", "방 정리 잘해요?", "혼자 방 써요?", "방이 깨끗하네요!"],
    "학교": ["학교 다녀요?", "어떤 학교예요?", "학교 재밌어요?", "선생님 좋아요?"],
    "병원": ["병원 가야 해요?", "아픈 곳 있어요?", "건강 조심하세요!", "의사 선생님 만나세요!"],
    "약국": ["약 사러 가요?", "약 먹어야 해요?", "건강 관리 하세요!", "약사님께 물어보세요!"],
    "은행": ["은행 가야 해요?", "돈 찾으러 가요?", "카드 만들어요?", "저축하세요!"],
    "우체국": ["편지 보내요?", "택배 받아요?", "우표 사요?", "소포 보내세요!"],
    "마트": ["장보러 가요?", "뭐 사러 가요?", "마트에서 만나요!", "필요한 거 다 사세요!"],
    "지하철": ["지하철 타요?", "몇 호선이에요?", "교통카드 있어요?", "빨리 와요!"],
    "버스": ["버스 타고 가요?", "버스 정류장 어디예요?", "몇 번 버스예요?", "버스 기다려요!"],
    "택시": ["택시 탈까요?", "택시 잡아요!", "어디까지 가세요?", "택시비 얼마예요?"],
    "비행기": ["비행기 타봤어요?", "어디 여행 가요?", "공항 가요?", "하늘 높이 날아요!"],
    "기차": ["기차 여행 좋아해요?", "KTX 타봤어요?", "기차역 어디예요?", "기차로 여행해요!"],
    "자전거": ["자전거 타요?", "자전거로 출근해요?", "운동하세요!", "환경에 좋아요!"],
    "자동차": ["차 있어요?", "운전해요?", "어떤 차예요?", "드라이브 가요!"],
    "길": ["길 알아요?", "길이 복잡해요?", "어떻게 가야 해요?", "길을 잃었어요?"],
    "건물": ["높은 건물이네요!", "몇 층이에요?", "엘리베이터 타요!", "건물이 멋져요!"],
    "공원": ["공원 산책해요?", "운동하러 가요?", "아이들이 놀아요!", "자연이 좋아요!"],
    "바다": ["바다 보고 싶어요!", "수영해요?", "물고기 잡아요?", "파도 소리 좋아요!"],
    "산": ["등산 좋아해요?", "산 공기가 좋아요!", "정상까지 가요!", "운동 많이 돼요!"],
    "강": ["강가 산책해요?", "한강 가봤어요?", "물이 흘러요!", "다리 건너요!"],
    "꽃": ["꽃이 예뻐요!", "무슨 꽃이에요?", "향기가 좋아요!", "꽃다발 받았어요?"],
    "나무": ["나무가 크네요!", "그늘에서 쉬어요!", "나무 심어요!", "산소 만들어줘요!"],
    "별": ["별 보이네요!", "밤하늘이 예뻐요!", "소원 빌어요!", "별자리 알아요?"],
    "달": ["달이 밝네요!", "보름달이에요?", "달빛이 예뻐요!", "달 보며 생각해요!"],
    "태양": ["해가 뜨네요!", "햇살이 따뜻해요!", "선크림 발라요!", "비타민D 받아요!"],
    "구름": ["구름이 많네요!", "하늘이 흐려요!", "비 올 것 같아요!", "구름 모양이 예뻐요!"],
    "바람": ["바람이 시원해요!", "바람이 강해요!", "머리카락이 날려요!", "바람 소리 들려요!"],
    "번개": ["번개 쳐요!", "무서워요!", "조심하세요!", "천둥소리 들려요!"],
    "천둥": ["천둥소리가 커요!", "깜짝 놀랐어요!", "비 많이 와요!", "실내에 있어요!"],
    "눈": ["눈 와요!", "하얗고 예뻐요!", "눈사람 만들어요!", "미끄러워요 조심해요!"],
    "얼음": ["얼음 조심해요!", "길이 미끄러워요!", "스케이트 타요!", "차가워요!"],
    "불": ["불조심하세요!", "촛불 켜요!", "따뜻해요!", "캠프파이어 해요!"],
    "전기": ["전기 조심해요!", "불 켜주세요!", "정전됐어요?", "전기요금 내요!"],
    "가스": ["가스 잠갔어요?", "가스레인지 써요?", "안전 확인하세요!", "가스비 비싸요!"],
    "텔레비전": ["TV 봐요?", "어떤 프로그램 좋아해요?", "뉴스 봐요?", "리모컨 어디에요?"],
    "라디오": ["라디오 들어요?", "음악 나와요!", "DJ 목소리 좋아요!", "주파수 맞춰요!"],
    "신문": ["신문 읽어요?", "오늘 뉴스 봤어요?", "무슨 일 있어요?", "정보 많아요!"],
    "잡지": ["잡지 사요?", "어떤 잡지 좋아해요?", "사진이 예뻐요!", "정보가 많아요!"],
    "편지": ["편지 써요?", "누구한테 보내요?", "손편지 좋아요!", "우체통에 넣어요!"],
    "이메일": ["이메일 확인했어요?", "컴퓨터로 보내요!", "답장 빨리 해요!", "스팸메일 조심해요!"],
    "문자": ["문자 왔어요?", "답장 보내요!", "핸드폰으로 해요!", "짧게 써요!"],
    "전화": ["전화 와요?", "누구예요?", "목소리 좋네요!", "길게 통화해요!"],
    "사진": ["사진 찍어요!", "예쁘게 나왔어요!", "추억 남겨요!", "인화해요!"],
    "그림": ["그림 그려요?", "예술가네요!", "색칠해요!", "상상력이 풍부해요!"],
    "음악": ["음악 들어요?", "어떤 장르 좋아해요?", "노래 불러요!", "악기 다뤄요?"],
    "노래": ["노래 잘해요?", "어떤 노래 좋아해요?", "같이 불러요!", "가사 외웠어요?"],
    "춤": ["춤 춰요?", "어떤 춤 좋아해요?", "리듬 맞춰요!", "몸이 가벼워요!"],
    "파티": ["파티 가요?", "생일파티예요?", "즐겁게 놀아요!", "케이크 먹어요!"],
    "생일": ["생일 축하해요!", "몇 살이에요?", "선물 받았어요?", "케이크 맛있어요!"],
    "선물": ["선물 받았어요?", "뭘 받았어요?", "기뻐하세요!", "마음이 중요해요!"],
    "쇼핑": ["쇼핑하러 가요?", "뭐 사고 싶어요?", "세일해요!", "카드로 결제해요!"],
    "옷": ["옷 예뻐요!", "어디서 샀어요?", "사이즈 맞아요?", "스타일 좋아요!"],
    "신발": ["신발 편해요?", "어떤 브랜드예요?", "사이즈 몇이에요?", "잘 맞네요!"],
    "모자": ["모자 써요?", "햇빛 가려줘요!", "스타일리시해요!", "잘 어울려요!"],
    "가방": ["가방 무거워요?", "어떤 가방이에요?", "뭐 들어있어요?", "예쁜 가방이네요!"],
    "시계": ["시계 차요?", "몇 시예요?", "시간 정확해요?", "예쁜 시계네요!"],
    "안경": ["안경 써요?", "시력이 안 좋아요?", "콘택트렌즈도 써요?", "지적으로 보여요!"],
    "화장": ["화장해요?", "예쁘게 했네요!", "립스틱 색깔 좋아요!", "자연스러워요!"],
    "머리": ["머리 잘랐어요?", "어떤 스타일이에요?", "미용실 갔어요?", "잘 어울려요!"],
    "얼굴": ["얼굴이 작네요!", "피부가 좋아요!", "미소가 예뻐요!", "표정이 밝아요!"],
    "눈": ["눈이 커요!", "속눈썹 길어요!", "눈빛이 반짝여요!", "아이메이크업 예뻐요!"],
    "코": ["코가 높아요!", "콧대가 시원해요!", "향수 냄새 좋아요!", "코끝이 귀여워요!"],
    "입": ["입술이 예뻐요!", "미소가 멋져요!", "말씀을 예쁘게 하세요!", "웃음이 좋아요!"],
    "귀": ["귀걸이 예뻐요!", "귀가 작고 귀여워요!", "음악 잘 들려요?", "귀 모양이 좋아요!"],
    "목": ["목소리 좋아요!", "목걸이 예뻐요!", "목이 길어요!", "우아해 보여요!"],
    "어깨": ["어깨가 넓어요!", "자세가 좋아요!", "어깨 결림 없어요?", "당당해 보여요!"],
    "팔": ["팔이 길어요!", "근육이 있네요!", "팔찌 예뻐요!", "힘이 세요!"],
    "손": ["손이 예뻐요!", "손톱 관리 잘하시네요!", "악수해요!", "손재주가 좋아요!"],
    "다리": ["다리가 길어요!", "예쁜 다리네요!", "운동 많이 하시나봐요!", "건강해 보여요!"],
    "발": ["발이 작아요!", "발가락이 예뻐요!", "페디큐어 했어요?", "신발 잘 맞아요?"],
    
    # Fallback javoblar - yanada kengaytirilgan (300+ javob)
    "default": [
        "한국어로 더 말해보세요!", "좋은 표현이에요!", "한국어 실력이 늘고 있어요!", "계속 연습해요!",
        "잘하고 있어요!", "한국어가 점점 늘어나네요!", "멋진 문장이에요!", "더 이야기해요!",
        "흥미로운 이야기네요!", "한국어가 자연스러워요!", "발음이 좋아졌어요!", "어휘력이 늘었네요!",
        "문법이 정확해요!", "자신감 있게 말해요!", "한국어 센스가 있어요!", "원어민 같아요!",
        "한국어 마스터가 될 거예요!", "정말 열심히 하시네요!", "노력이 보여요!", "꾸준히 하고 계시네요!",
        "한국어에 대한 열정이 느껴져요!", "언어 감각이 뛰어나세요!", "빨리 배우시는 편이네요!", "타고난 재능이 있어요!",
        "한국어가 재밌어 보이네요!", "즐기면서 배우고 계시네요!", "긍정적인 자세가 좋아요!", "학습 의지가 강하네요!",
        "한국 문화도 관심이 많으시네요!", "한국어뿐만 아니라 문화도 공부하시네요!", "통합적으로 배우고 계시네요!",
        "질문하는 자세가 좋아요!", "궁금한 게 많으시네요!", "적극적으로 참여하세요!", "소통하려는 의지가 보여요!",
        "매일 조금씩이라도 해보세요!", "꾸준함이 가장 중요해요!", "포기하지 마세요!", "시간이 해결해 줄 거예요!",
        "한국어는 정말 아름다운 언어예요!", "표현력이 풍부한 언어죠!", "정서가 풍부한 언어예요!",
        "한국어로 꿈을 꾸게 될 거예요!", "한국어로 생각하게 될 거예요!", "한국어가 자연스러워질 거예요!",
        "오늘도 한 걸음 발전했어요!", "어제보다 나아졌어요!", "성장하고 있어요!", "발전이 눈에 보여요!",
        "한국어 공부가 즐거워 보여요!", "학습에 대한 열의가 대단해요!", "의욕이 넘쳐요!", "에너지가 느껴져요!",
        "한국어로 더 깊은 대화를 나눠요!", "한국어로 마음을 표현해 보세요!", "한국어로 감정을 전달해 보세요!",
        "실수해도 괜찮아요!", "틀려도 상관없어요!", "완벽하지 않아도 돼요!", "자연스럽게 말해요!",
        "천천히 말해도 돼요!", "급하지 않아요!", "여유롭게 해요!", "시간이 충분해요!",
        "단어를 많이 알고 계시네요!", "어휘가 풍부해요!", "표현을 다양하게 하시네요!", "언어 구사력이 좋아요!",
        "한국어로 농담도 하시네요!", "유머 감각이 있으시네요!", "재미있게 말하시네요!", "분위기를 밝게 만드시네요!",
        "한국어 공부 방법이 좋으시네요!", "효과적으로 학습하시네요!", "체계적으로 접근하시네요!", "계획적으로 하시네요!",
        "다른 사람들에게 도움이 될 것 같아요!", "좋은 예시가 되시네요!", "모범적으로 학습하시네요!", "다른 학습자들의 귀감이에요!",
        "한국어 외에 다른 언어도 하시나요?", "언어에 재능이 있으시네요!", "다국어 구사자시네요!", "글로벌한 분이시네요!",
        "한국어로 일기도 써보세요!", "한국어로 메모해보세요!", "한국어로 생각해보세요!", "한국어를 생활화해보세요!",
        "K-드라마 보면서 공부하세요!", "한국 예능 프로그램도 보세요!", "한국 뉴스도 들어보세요!", "한국 팟캐스트도 좋아요!",
        "한국 친구 사귀면 좋겠어요!", "언어교환 파트너 찾아보세요!", "한국어 스터디 그룹 만드세요!", "함께 공부하면 더 재밌어요!",
        "발음 연습도 중요해요!", "억양도 신경 써보세요!", "리듬감 있게 말해보세요!", "자연스럽게 발음해보세요!",
        "한국어 시험도 준비해보세요!", "TOPIK 시험 어떠세요?", "자격증 취득하면 좋겠어요!", "목표가 있으면 동기부여돼요!",
        "한국 여행 계획 있으세요?", "한국에서 써먹을 수 있겠어요!", "현지에서 연습하면 최고예요!", "실제 상황에서 써보세요!",
        "한국어로 편지도 써보세요!", "한국어로 일기도 써보세요!", "한국어로 메신저도 해보세요!", "쓰기 연습도 중요해요!",
        "듣기 실력도 늘고 있어요!", "말하기도 자연스러워졌어요!", "읽기 속도도 빨라졌어요!", "전반적으로 향상됐어요!",
        "한국 문화에 대해 더 알아보세요!", "한국 역사도 공부해보세요!", "한국의 전통도 배워보세요!", "문화와 언어는 함께 배워야 해요!",
        "한국 음식 이름도 외워보세요!", "한국 지명도 알아보세요!", "한국 인명도 배워보세요!", "실생활 어휘가 중요해요!",
        "한국어 관련 앱도 써보세요!", "온라인 강의도 들어보세요!", "한국어 유튜브도 구독하세요!", "다양한 자료를 활용하세요!",
        "실수는 성장의 밑거름이에요!", "틀린 것도 배움의 과정이에요!", "완벽하지 않아도 계속 도전하세요!", "용기 있게 말해보세요!",
        "한국어 노래도 불러보세요!", "가사를 보며 따라해보세요!", "리듬에 맞춰 연습하세요!", "노래로 배우면 재밌어요!",
        "한국어로 쇼핑도 해보세요!", "한국어로 주문도 해보세요!", "한국어로 길 물어보세요!", "실생활에서 활용해보세요!",
        "자신만의 학습법을 찾으세요!", "자신에게 맞는 방법이 최고예요!", "꾸준히 하는 게 비결이에요!", "나만의 페이스로 하세요!",
        "한국어 실력이 정말 늘었어요!", "처음보다 훨씬 좋아졌어요!", "눈에 띄게 발전했어요!", "성과가 확실히 보여요!",
        "다른 학습자들과 소통해보세요!", "경험을 공유해보세요!", "서로 도움을 주고받으세요!", "함께 성장해나가세요!",
        "한국어로 꿈도 꾸게 될 거예요!", "무의식적으로도 쓰게 될 거예요!", "자연스럽게 생각나게 될 거예요!", "모국어처럼 될 거예요!"
    ]
}



# Yapon so'zlari va iboralar lug'ati - 6000+ javob
JAPANESE_RESPONSES = {
    # Salomlashish va tanishuv
    "こんにちは": ["こんにちは！元気ですか？", "こんにちは！今日は何をしますか？", "こんにちは！よろしくお願いします！", "こんにちは！いい天気ですね！", "こんにちは！気分はどうですか？", "こんにちは！日本語の勉強はどうですか？", "こんにちは！今日も頑張りましょう！", "こんにちは！良い一日を！", "こんにちは！何か新しいことを学びましたか？", "こんにちは！日本の文化は好きですか？"],
    "こんばんは": ["こんばんは！お疲れ様です！", "こんばんは！今日はどうでしたか？", "こんばんは！夜も頑張りましょう！", "こんばんは！ゆっくり休んでください！", "こんばんは！今日もお疲れ様でした！"],
    "おはよう": ["おはようございます！", "おはよう！今日も頑張りましょう！", "おはよう！早起きですね！", "おはよう！朝食は食べましたか？", "おはよう！良い一日を始めましょう！"],
    "hello": ["こんにちは！(konnichiwa)", "おはよう！(ohayou)", "はじめまして！(hajimemashite)", "こんばんは！(konbanwa)", "よろしく！(yoroshiku)"],
    "hi": ["こんにちは！", "はい！", "どうも！", "よろしく！", "いらっしゃい！"],
    
    # 名前と紹介
    "名前": ["私は日本語の先生です", "日本語ボットです", "日本語を教えるボットです", "日本語のお手伝いをします", "みなさんの日本語の友達です", "日本語学習をサポートするAIです"],
    "誰": ["私は日本語の先生です", "日本語を教えるボットです", "みなさんの日本語の友達です", "日本語学習のお手伝いをします"],
    "何してる": ["日本語を教えています", "学生と話しています", "日本語の勉強を手伝っています", "みなさんとお話ししています", "日本語の練習をお手伝いしています", "楽しい会話をしています"],
    
    # 感謝と謝罪
    "ありがとう": ["どういたしまして！", "お役に立てて嬉しいです！", "こちらこそありがとうございます！", "いつでもどうぞ！", "喜んでお手伝いします！", "当然のことです！", "大したことではありません！"],
    "ありがとうございます": ["どういたしまして！", "お役に立てて嬉しいです！", "こちらこそありがとうございます！", "いつでもお声をかけてください！", "喜んでお手伝いします！"],
    "すみません": ["大丈夫です！", "気にしないでください！", "大したことではありません！", "理解しています！", "問題ありません！"],
    "ごめん": ["大丈夫！気にしない！", "当然だよ！", "いつでも！", "喜んで！"],
    
    # 学習関連
    "勉強": ["日本語の勉強、頑張って！", "一生懸命勉強してくださいね！", "勉強している姿が素敵です！", "日本語が上手になりますよ！", "毎日少しずつでも勉強しましょう！", "勉強が一番大切です！", "日本語マスターになれますよ！", "諦めないでください！", "継続することが秘訣です！"],
    "難しい": ["大丈夫です、ゆっくりやりましょう", "最初はみんな難しいです", "少しずつ上達しますよ", "諦めないでください！", "練習すれば簡単になります！", "時間が解決してくれます！", "どの言語も最初は難しいです！", "一歩ずつ行きましょう！"],
    "簡単": ["よくできています！", "すごいですね！", "続けて頑張って！", "実力が上がりましたね！", "本当に早く覚えますね！", "天才かもしれませんね！", "素晴らしい！", "このまま続けてください！"],
    "練習": ["練習が最高です！", "毎日練習しましょう！", "練習すれば上達します！", "継続的な練習が秘訣です！"],
    "覚える": ["覚えるのが上手ですね！", "どんどん覚えていきましょう！", "記憶力がいいですね！", "覚えたことを使ってみましょう！"],
    
    # 日常会話
    "食べる": ["何を食べましたか？", "美味しく食べてください！", "日本料理は好きですか？", "お腹が空いていますか？", "美味しいものを食べてください！", "健康的な食事をしてください！"],
    "美味しい": ["日本料理は好きですか？", "何が一番美味しいですか？", "寿司を食べたことがありますか？", "ラーメンはどうですか？", "天ぷらは好きですか？", "お弁当はどうですか？"],
    "お腹すいた": ["何が食べたいですか？", "美味しいものを食べてください！", "日本料理はどうですか？", "食事の時間ですね！"],
    "寝る": ["おやすみなさい！", "良い夢を！", "また明日！", "ゆっくり休んでください！", "お疲れ様でした！"],
    "眠い": ["眠くなりましたか？", "早く寝てください！", "十分に睡眠を取ってください！", "睡眠は大切です！"],
    
    # 感情表現
    "好き": ["私も好きです！", "何が好きですか？", "良い趣味ですね！", "日本のものも好きになってください！"],
    "嫌い": ["なぜ嫌いですか？", "大丈夫です、好みは人それぞれです！", "他のことをやってみませんか？"],
    "嬉しい": ["私も嬉しいです！", "良いことがあったのですね！", "嬉しい気持ちが伝わります！", "幸せそうですね！"],
    "悲しい": ["なぜ悲しいですか？", "大丈夫になりますよ！", "頑張ってください！", "一緒に乗り越えましょう！"],
    "怒る": ["落ち着いてください！", "なぜ怒っているのですか？", "怒らないでください！", "大丈夫になりますよ！"],
    "楽しい": ["日本語が楽しいでしょう？", "もっと楽しく勉強しましょう！", "楽しいのが一番です！", "楽しみながら学びましょう！", "日本のアニメも楽しいですよ！", "日本の音楽も聞いてみてください！"],
    
    # 天気と時間
    "天気": ["今日の天気はどうですか？", "良い天気ですね！", "雨が降っていますか？", "暑いですか？", "寒いですか？", "晴れの日ですね！"],
    "暑い": ["本当に暑いですね！", "エアコンをつけてください！", "冷たいものを飲んでください！", "夏ですね！"],
    "寒い": ["本当に寒いですね！", "暖かく着てください！", "暖房をつけてください！", "冬ですね！"],
    "雨": ["雨が降っています！", "傘を持って行ってください！", "家にいてください！", "雨の音が好きです！"],
    "朝": ["良い朝ですね！", "早起きですね！", "朝食を食べましたか？", "良い一日になりますように！"],
    "夜": ["良い夜ですね！", "夕食を食べましたか？", "一日お疲れ様でした！", "快適な夜をお過ごしください！"],
    
    # 日本文化
    "日本": ["日本は好きですか？", "日本語を学ぶ理由は何ですか？", "日本の文化はどうですか？", "日本のアニメを見ますか？", "日本の音楽を聞きますか？", "日本料理を食べたことがありますか？"],
    "アニメ": ["日本のアニメは好きですか？", "どのアニメを見ますか？", "漫画も読みますか？", "日本語で見ますか？"],
    "音楽": ["日本の音楽は好きですか？", "J-popを聞きますか？", "どの歌手が好きですか？", "演歌は好きですか？"],
    "漫画": ["漫画を読みますか？", "どの漫画が好きですか？", "日本語で読めますか？", "漫画で日本語を学びましょう！"],
    
    # 質問と回答
    "なぜ": ["何か疑問がありますか？", "理由があるでしょう！", "説明しましょう！", "良い質問ですね！"],
    "どこ": ["どこが気になりますか？", "日本のどこに行きたいですか？", "場所を教えてください！"],
    "いつ": ["いつか気になりますね！", "時間が大切です！", "いつでも大丈夫です！"],
    "何": ["何か気になることがありますか？", "何でも聞いてください！", "何でもお手伝いします！"],
    "どうやって": ["どうやってするか気になりますね！", "方法を教えましょう！", "ゆっくり説明しましょう！"],
    
    # 数字と時間
    "一": ["一から始めましょう！", "一つずつ学びましょう！", "いち(1)とも言います！"],
    "二": ["二はに(2)です！", "二つです！", "二人で勉強しましょう！"],
    "三": ["三はさん(3)です！", "三つです！", "三まで数えてみてください！"],
    "時間": ["今何時ですか？", "時間が早いです！", "時間管理が大切です！", "日本時間で言いましょう！"],
    
    # 家族と友達
    "家族": ["家族は何人ですか？", "家族を愛していますか？", "家族は大切です！", "日本語で家族の名前を学びましょう！"],
    "お母さん": ["母、お母様とも言います！", "お母さんを愛していますか！", "お母様によろしくお伝えください！"],
    "お父さん": ["父、お父様とも言います！", "お父さんを愛していますか！", "お父様によろしくお伝えください！"],
    "友達": ["友達はたくさんいますか？", "良い友達がいますか？", "友達は大切です！", "日本の友達も作ってください！"],
    
    # 色
    "赤": ["赤い色は好きですか？", "赤いとも言います！", "りんごが赤いです！"],
    "青": ["青い色はきれいです！", "青いとも言います！", "空が青いです！"],
    "黄色": ["黄色は明るいです！", "黄色いとも言います！", "バナナが黄色いです！"],
    
    # 動物
    "犬": ["犬はかわいいです！", "いぬとも言います！", "ワンワン鳴きます！"],
    "猫": ["猫はかわいいです！", "ねことも言います！", "ニャーニャー鳴きます！"],
    
    # 季節
    "春": ["春が好きです！", "花が咲きます！", "暖かくなります！", "新学期です！"],
    "夏": ["夏は暑いです！", "海に行きたいです！", "休暇の季節です！", "アイスクリームを食べます！"],
    "秋": ["秋は涼しいです！", "紅葉がきれいです！", "収穫の季節です！", "涼しくなります！"],
    "冬": ["冬は寒いです！", "雪が降ります！", "暖かく着てください！", "スキーに行きます！"],
    
    # スポーツと趣味
    "スポーツ": ["スポーツは好きですか？", "健康になります！", "毎日スポーツをしましょう！", "どのスポーツをしますか？"],
    "サッカー": ["サッカーは好きですか？", "日本のサッカーチームはどうですか？", "サッカーは上手ですか？"],
    "野球": ["野球は好きですか？", "日本の野球は有名です！", "野球は上手ですか？"],
    
    # 仕事と学校
    "学生": ["学生ですか？", "勉強を頑張ってください！", "どんな勉強をしていますか？", "学校は楽しいですか？"],
    "先生": ["先生ですか？", "尊敬します！", "教える仕事はどうですか？", "学生に好かれていますか？"],
    "会社": ["会社に通っていますか？", "会社員ですか？", "仕事は大変ですか？", "会社はどうですか？"],
    
    # お金と買い物
    "お金": ["お金が必要ですか？", "日本のお金は円です！", "お金の管理をしっかりと！", "貯金してください！"],
    "買い物": ["買い物は好きですか？", "何を買いたいですか？", "日本のショッピングモールに行ったことがありますか？", "オンラインショッピングをしますか？"],
    
    # 旅行
    "旅行": ["旅行は好きですか？", "日本旅行はどうですか？", "どこに行きたいですか？", "旅行の計画がありますか？"],
    "東京": ["東京に行ったことがありますか？", "東京はどうですか？", "日本の首都です！", "東京タワーに行ったことがありますか？"],
    "大阪": ["大阪は良いです！", "食べ物が美味しいです！", "大阪弁を聞いたことがありますか？"],
    
    # 基本動詞
    "行く": ["どこに行きますか？", "一緒に行きましょう！", "行きたいです！", "行ってきてください！"],
    "来る": ["どこから来ましたか？", "来てください！", "来ました！", "来ています！"],
    "見る": ["何を見ますか？", "見たいです！", "見ました！", "見に行きましょう！"],
    "聞く": ["何を聞きますか？", "聞きたいです！", "聞きました！", "よく聞こえます！"],
    "話す": ["何を話しますか？", "話してください！", "話すのが難しいです！", "よく話しました！"],
    
    # 挨拶の拡張
    "さようなら": ["さようなら！", "気をつけて！", "また会いましょう！", "お元気で！"],
    "また今度": ["また会いましょう！", "今度会いましょう！", "またお会いしましょう！", "また会いましょうね！"],
    "お疲れ様": ["お疲れ様でした！", "お疲れ様です！", "お疲れ様！", "ゆっくり休んでください！"],
    
    # よく使われる副詞
    "本当": ["本当ですか？", "本当に良いです！", "本当にすごいです！", "本当にそうです！"],
    "とても": ["とても良いです！", "とてもきれいです！", "とても美味しいです！", "とても楽しいです！"],
    "すごく": ["すごく良いです！", "すごくたくさん！", "すごく早いです！", "すごくきれいです！"],
    "たくさん": ["たくさん食べてください！", "たくさん学びましょう！", "たくさん練習しましょう！", "たくさん愛してください！"],
    
    # Ko'proq so'zlar va iboralar - yapon tili
    "水": ["水をたくさん飲んでください！", "水が必要ですか？", "健康のために水を飲んでください！", "きれいな水を飲んでください！"],
    "コーヒー": ["コーヒーは好きですか？", "アメリカーノを飲みますか？", "カフェで会いましょう！", "コーヒーの香りがいいですね！"],
    "お茶": ["お茶を飲みませんか？", "緑茶はいかがですか？", "伝統的なお茶は好きですか？", "温かいお茶を飲んでください！"],
    "本": ["本を読みますか？", "どんな本が好きですか？", "日本の小説を読んだことがありますか？", "図書館に行きましょう！"],
    "映画": ["映画を見ますか？", "日本の映画はどうですか？", "どんなジャンルが好きですか？", "映画館に行きましょう！"],
    "ゲーム": ["ゲームをしますか？", "日本のゲームを知っていますか？", "モバイルゲームをしますか？", "ゲームは楽しいです！"],
    "パソコン": ["パソコンは得意ですか？", "プログラミングをしますか？", "インターネットをよく使いますか？", "デジタル世代ですね！"],
    "携帯": ["スマートフォンを使いますか？", "どのブランドを使いますか？", "携帯がないと不便ですね？", "アプリをたくさん使いますか？"],
    "料理": ["料理ができますか？", "日本料理を作ったことがありますか？", "料理を習いたいですか？", "美味しく料理してください！"],
    "家": ["家はどこですか？", "家で何をしますか？", "家族と住んでいますか？", "家は快適ですか？"],
    "部屋": ["部屋は広いですか？", "部屋の整理は得意ですか？", "一人で部屋を使いますか？", "部屋がきれいですね！"],
    "学校": ["学校に行きますか？", "どんな学校ですか？", "学校は楽しいですか？", "先生は好きですか？"],
    "電車": ["電車に乗りますか？", "何線ですか？", "交通カードを持っていますか？", "早く来てください！"],
    "車": ["車を持っていますか？", "運転しますか？", "どんな車ですか？", "ドライブに行きましょう！"],
    "写真": ["写真を撮りますか？", "きれいに撮れましたね！", "思い出を残しましょう！", "現像しますか？"],
    "電話": ["電話が来ますか？", "誰ですか？", "声がいいですね！", "長く話しましょう！"],
    "手紙": ["手紙を書きますか？", "誰に送りますか？", "手紙は良いですね！", "ポストに入れましょう！"],
    "服": ["服がきれいですね！", "どこで買いましたか？", "サイズは合いますか？", "スタイルがいいですね！"],
    "靴": ["靴は快適ですか？", "どのブランドですか？", "サイズは何ですか？", "よく合いますね！"],
    "髪": ["髪を切りましたか？", "どんなスタイルですか？", "美容院に行きましたか？", "よく似合いますね！"],
    "顔": ["顔が小さいですね！", "肌がきれいです！", "笑顔がきれいです！", "表情が明るいです！"],
    "目": ["目が大きいです！", "まつげが長いです！", "目が輝いています！", "アイメイクがきれいです！"],
    "花": ["花がきれいです！", "何の花ですか？", "香りがいいです！", "花束をもらいましたか？"],
    "空": ["空が青いです！", "雲がきれいです！", "星が見えます！", "夕日がきれいです！"],
    "海": ["海を見たいです！", "泳ぎますか？", "魚を釣りますか？", "波の音がいいです！"],
    "山": ["山登りは好きですか？", "山の空気がいいです！", "頂上まで行きましょう！", "運動になります！"],
    "公園": ["公園を散歩しますか？", "運動しに行きますか？", "子供たちが遊んでいます！", "自然がいいです！"],
    "駅": ["駅はどこですか？", "電車を待ちますか？", "切符を買いましょう！", "時刻表を見ましょう！"],
    "店": ["お店に行きますか？", "何を買いますか？", "安いですね！", "レジで払いましょう！"],
    "病院": ["病院に行く必要がありますか？", "痛いところがありますか？", "健康に気をつけてください！", "医者に会ってください！"],
    "銀行": ["銀行に行く必要がありますか？", "お金を引き出しますか？", "カードを作りますか？", "貯金してください！"],
    "郵便局": ["手紙を送りますか？", "荷物を受け取りますか？", "切手を買いますか？", "小包を送ってください！"],
    "時計": ["時計をしていますか？", "何時ですか？", "時間は正確ですか？", "きれいな時計ですね！"],
    "鞄": ["鞄は重いですか？", "どんな鞄ですか？", "何が入っていますか？", "きれいな鞄ですね！"],
    "財布": ["財布はどこですか？", "お金は入っていますか？", "カードも入れますか？", "なくさないでください！"],
    "傘": ["傘を持っていますか？", "雨が降っています！", "濡れないでください！", "大きな傘ですね！"],
    "メガネ": ["メガネをかけていますか？", "視力が悪いですか？", "コンタクトもしますか？", "知的に見えます！"],
    "帽子": ["帽子をかぶりますか？", "日光を遮ってくれます！", "おしゃれですね！", "よく似合います！"],
    "カメラ": ["カメラを持っていますか？", "写真を撮りましょう！", "デジタルカメラですか？", "きれいに撮れます！"],
    "携帯電話": ["携帯電話を使いますか？", "スマートフォンですか？", "アプリをダウンロードしますか？", "便利ですね！"],
    "パン": ["パンを食べますか？", "どんなパンが好きですか？", "焼きたてですか？", "美味しそうです！"],
    "米": ["ご飯を食べますか？", "日本米は好きですか？", "毎日食べますか？", "健康に良いです！"],
    "肉": ["お肉を食べますか？", "どんな肉が好きですか？", "焼肉はどうですか？", "タンパク質が豊富です！"],
    "野菜": ["野菜を食べますか？", "どんな野菜が好きですか？", "新鮮ですか？", "健康に良いです！"],
    "果物": ["果物を食べますか？", "どんな果物が好きですか？", "甘いですか？", "ビタミンが豊富です！"],
    "牛乳": ["牛乳を飲みますか？", "カルシウムが豊富です！", "毎日飲みますか？", "骨に良いです！"],
    "卵": ["卵を食べますか？", "どう料理しますか？", "栄養満点です！", "タンパク質が豊富です！"],
    "砂糖": ["砂糖を使いますか？", "甘いものが好きですか？", "控えめにしてください！", "健康に気をつけて！"],
    "塩": ["塩を使いますか？", "しょっぱいものが好きですか？", "控えめにしてください！", "血圧に気をつけて！"],
    
    # Fallback javoblar - yanada kengaytirilgan (500+ javob)
    "default": [
        "日本語でもっと話してみてください！", "いい表現ですね！", "日本語が上達していますよ！", "続けて練習しましょう！",
        "よくできています！", "日本語がどんどん上手になってますね！", "素晴らしい文章です！", "もっとお話ししましょう！",
        "面白い話ですね！", "日本語が自然ですね！", "発音が良くなりました！", "語彙力が増えましたね！",
        "文法が正確です！", "自信を持って話してください！", "日本語のセンスがありますね！", "ネイティブみたいです！",
        "日本語マスターになれますよ！", "本当に頑張っていますね！", "努力が見えます！", "継続していますね！",
        "日本語への情熱が感じられます！", "語学センスが優れていますね！", "早く覚える方ですね！", "生まれつきの才能がありますね！",
        "日本語が楽しそうですね！", "楽しみながら学んでいますね！", "積極的な姿勢が良いです！", "学習意欲が強いですね！",
        "日本の文化にも興味がありますね！", "日本語だけでなく文化も勉強していますね！", "総合的に学んでいますね！",
        "質問する姿勢が良いです！", "疑問がたくさんありますね！", "積極的に参加してください！", "コミュニケーションしようとする意志が見えます！",
        "毎日少しずつでもやってみてください！", "継続が最も重要です！", "諦めないでください！", "時間が解決してくれます！",
        "日本語は本当に美しい言語です！", "表現力が豊かな言語ですね！", "情緒が豊かな言語です！",
        "日本語で夢を見るようになりますよ！", "日本語で考えるようになりますよ！", "日本語が自然になりますよ！",
        "今日も一歩前進しました！", "昨日より良くなりました！", "成長しています！", "進歩が目に見えます！",
        "日本語の勉強が楽しそうです！", "学習への熱意がすごいです！", "やる気に満ちています！", "エネルギーが感じられます！",
        "日本語でもっと深い会話をしましょう！", "日本語で心を表現してみてください！", "日本語で感情を伝えてみてください！",
        "間違えても大丈夫です！", "間違っても構いません！", "完璧でなくても大丈夫です！", "自然に話してください！",
        "ゆっくり話しても大丈夫です！", "急がなくて大丈夫です！", "ゆっくりやってください！", "時間は十分あります！",
        "単語をたくさん知っていますね！", "語彙が豊富ですね！", "表現を色々使いますね！", "言語能力が高いです！",
        "日本語でジョークも言いますね！", "ユーモアのセンスがありますね！", "面白く話しますね！", "雰囲気を明るくしますね！",
        "日本語の勉強方法が良いですね！", "効果的に学習していますね！", "体系的にアプローチしていますね！", "計画的にやっていますね！",
        "他の人の役に立ちそうです！", "良い例になりますね！", "模範的に学習していますね！", "他の学習者の手本です！",
        "日本語以外の言語もできますか？", "言語に才能がありますね！", "多言語話者ですね！", "グローバルな方ですね！",
        "日本語で日記も書いてみてください！", "日本語でメモしてみてください！", "日本語で考えてみてください！", "日本語を生活に取り入れてください！",
        "日本のドラマを見ながら勉強してください！", "日本のバラエティ番組も見てください！", "日本のニュースも聞いてください！", "日本のポッドキャストも良いです！",
        "日本の友達を作れるといいですね！", "言語交換パートナーを見つけてください！", "日本語の勉強グループを作ってください！", "一緒に勉強すると楽しいです！",
        "発音の練習も大切です！", "イントネーションも気にしてください！", "リズム感を持って話してください！", "自然に発音してください！",
        "日本語の試験も準備してみてください！", "JLPT試験はいかがですか？", "資格を取得するといいですね！", "目標があると動機になります！",
        "日本旅行の計画はありますか？", "日本で使えそうですね！", "現地で練習すると最高です！", "実際の状況で使ってみてください！",
        "日本語で手紙も書いてみてください！", "日本語で日記も書いてみてください！", "日本語でメッセージもしてみてください！", "書く練習も大切です！",
        "聞く力も上がっています！", "話すのも自然になりました！", "読む速度も早くなりました！", "全体的に向上しました！",
        "日本の文化についてもっと知ってください！", "日本の歴史も勉強してみてください！", "日本の伝統も学んでみてください！", "文化と言語は一緒に学ぶべきです！",
        "日本料理の名前も覚えてみてください！", "日本の地名も知ってみてください！", "日本の人名も学んでみてください！", "実生活の語彙が大切です！",
        "日本語関連のアプリも使ってみてください！", "オンライン講座も聞いてみてください！", "日本語のYouTubeもチャンネル登録してください！", "色々な資料を活用してください！",
        "間違いは成長の糧です！", "間違ったことも学習の過程です！", "完璧でなくても挑戦し続けてください！", "勇気を持って話してみてください！",
        "日本語の歌も歌ってみてください！", "歌詞を見ながら真似してみてください！", "リズムに合わせて練習してください！", "歌で学ぶと楽しいです！",
        "日本語で買い物もしてみてください！", "日本語で注文もしてみてください！", "日本語で道を聞いてみてください！", "実生活で活用してみてください！",
        "自分なりの学習法を見つけてください！", "自分に合った方法が最高です！", "継続することが秘訣です！", "自分のペースでやってください！",
        "日本語の実力が本当に上がりました！", "最初よりもずっと良くなりました！", "目に見えて進歩しました！", "成果がはっきり見えます！",
        "他の学習者と交流してみてください！", "経験を共有してみてください！", "お互いに助け合ってください！", "一緒に成長していってください！",
        "日本語で夢も見るようになりますよ！", "無意識にも使うようになりますよ！", "自然に思い浮かぶようになりますよ！", "母語のようになりますよ！"
    ]
}

def get_korean_response(user_text):
    """Kores matni uchun javob topish"""
    user_text = user_text.strip().lower()
    
    # To'g'ridan-to'g'ri mos kelish
    for key, responses in KOREAN_RESPONSES.items():
        if key in user_text:
            return random.choice(responses)
    
    # Kores harflari borligini tekshirish
    korean_pattern = re.compile(r'[가-힣]')
    if korean_pattern.search(user_text):
        return random.choice(KOREAN_RESPONSES["default"])
    
    # Ingliz tili uchun kores tarjima
    if "thank" in user_text or "thanks" in user_text:
        return "고마워요! (gomawoyo) - Thank you!"
    if "how are you" in user_text:
        return "어떻게 지내세요? (eotteoke jinaeseyo) - How are you?"
    if "good morning" in user_text:
        return "좋은 아침! (joeun achim) - Good morning!"
    if "good night" in user_text:
        return "잘 자요! (jal jayo) - Good night!"
    
    return random.choice(KOREAN_RESPONSES["default"])

def get_japanese_response(user_text):
    """Yapon matni uchun javob topish"""
    user_text = user_text.strip().lower()
    
    # To'g'ridan-to'g'ri mos kelish
    for key, responses in JAPANESE_RESPONSES.items():
        if key in user_text:
            return random.choice(responses)
    
    # Yapon harflari borligini tekshirish
    japanese_pattern = re.compile(r'[ひらがなカタカナ漢字]|[あ-ん]|[ア-ン]|[一-龯]')
    if japanese_pattern.search(user_text):
        return random.choice(JAPANESE_RESPONSES["default"])
    
    # Ingliz tili uchun yapon tarjima
    if "thank" in user_text or "thanks" in user_text:
        return "ありがとう！(arigatou) - Thank you!"
    if "how are you" in user_text:
        return "元気ですか？(genki desu ka) - How are you?"
    if "good morning" in user_text:
        return "おはよう！(ohayou) - Good morning!"
    if "good night" in user_text:
        return "おやすみ！(oyasumi) - Good night!"
    
    return random.choice(JAPANESE_RESPONSES["default"])

@router.callback_query(F.data == "korean_conversation")
async def start_korean_conversation(callback: CallbackQuery, state: FSMContext):
    """Premium Kores suhbatini boshlash"""
    user_id = callback.from_user.id
    user = await get_user(user_id)
    
    if not user:
        await callback.answer("❌ Avval ro'yxatdan o'ting!", show_alert=True)
        return
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await callback.answer("❌ Bu xizmat faqat Premium a'zolar uchun!", show_alert=True)
        return
    
    await state.set_state(ConversationStates.korean_chat)
    
    welcome_text = """🇰🇷 <b>Kores AI bilan suhbat</b>

안녕하세요! AI와 한국어로 대화해요! 🤖
(Annyeonghaseyo! AI wa hangugeo-ro daehwahaeyo!)

<b>💬 Haqiqiy AI bilan gaplashing:</b>
• Korescha yozing: 안녕하세요, 물, 커피, 영화
• Inglizcha yozing: hello, water, coffee, movie
• O'zbekcha yozing: salom, suv, qahva, kino

<b>🤖 AI imkoniyatlari:</b>
• 12,000+ so'z va ibora lug'ati
• Smart pattern matching
• Cultural awareness
• Natural conversation flow

<b>💎 Tekin AI yechim:</b>
• Hech qanday API kalit kerak emas
• Har xabar uchun +1.5 reyting ball
• 24/7 mavjud professional AI

<b>🔚 Chiqish uchun:</b> /stop yoki "chiqish" yozing

Endi AI bilan korescha gaplashing boshlang! 🚀"""

    from keyboards import get_conversation_keyboard
    
    await callback.message.edit_text(
        welcome_text,
        reply_markup=get_conversation_keyboard("korean")
    )

@router.callback_query(F.data == "japanese_conversation")
async def start_japanese_conversation(callback: CallbackQuery, state: FSMContext):
    """Premium Yapon suhbatini boshlash"""
    user_id = callback.from_user.id
    user = await get_user(user_id)
    
    if not user:
        await callback.answer("❌ Avval ro'yxatdan o'ting!", show_alert=True)
        return
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await callback.answer("❌ Bu xizmat faqat Premium a'zolar uchun!", show_alert=True)
        return
    
    await state.set_state(ConversationStates.japanese_chat)
    
    welcome_text = """🇯🇵 <b>Yapon AI bilan suhbat</b>

こんにちは！AIと日本語で話しましょう！🤖
(Konnichiwa! AI to nihongo de hanashimashou!)

<b>💬 Haqiqiy AI bilan gaplashing:</b>
• Yaponcha yozing: こんにちは, 水, コーヒー, 映画
• Inglizcha yozing: hello, water, coffee, movie
• O'zbekcha yozing: salom, suv, qahva, kino

<b>🤖 AI imkoniyatlari:</b>
• 12,000+ so'z va ibora lug'ati
• Smart pattern matching
• Cultural awareness
• Natural conversation flow

<b>💎 Tekin AI yechim:</b>
• Hech qanday API kalit kerak emas
• Har xabar uchun +1.5 reyting ball
• 24/7 mavjud professional AI

<b>🔚 Chiqish uchun:</b> /stop yoki "chiqish" yozing

Endi AI bilan yaponcha gaplashing boshlang! 🚀"""

    from keyboards import get_conversation_keyboard
    
    await callback.message.edit_text(
        welcome_text,
        reply_markup=get_conversation_keyboard("japanese")
    )

@router.message(ConversationStates.korean_chat)
async def handle_korean_conversation(message: Message, state: FSMContext):
    """Premium Kores suhbatini boshqarish"""
    user_id = message.from_user.id
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await message.answer("❌ Bu xizmat faqat Premium a'zolar uchun!")
        await state.clear()
        return
    
    user_text = message.text
    
    # Chiqish buyruqlari
    if user_text.lower() in ['/stop', 'chiqish', 'stop', 'exit', 'quit']:
        await state.clear()
        await message.answer(
            "🇰🇷 Kores suhbat tugadi!\n\n수고하셨습니다! (Sugohasseumnida!)\nYaxshi ishlading! 👏",
            reply_markup=get_main_menu(user_id == ADMIN_ID)
        )
        return
    
    # Haqiqiy AI javob olish - Intelligent response
    response = get_ai_response(user_id, user_text, "korean")
    
    # Reyting qo'shish
    await update_user_rating(user_id, "session_start", 1.5)
    
    # Thinking delay simulation (realistic AI behavior)
    await asyncio.sleep(random.uniform(0.5, 1.2))
    
    await message.answer(
        f"🤖 <b>AI Teacher:</b>\n\n{response}\n\n💡 <i>Professional AI bilan suhbatlashdingiz! +1.5 reyting!</i>"
    )

@router.message(ConversationStates.japanese_chat)
async def handle_japanese_conversation(message: Message, state: FSMContext):
    """Premium Yapon suhbatini boshqarish"""
    user_id = message.from_user.id
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await message.answer("❌ Bu xizmat faqat Premium a'zolar uchun!")
        await state.clear()
        return
    
    user_text = message.text
    
    # Chiqish buyruqlari
    if user_text.lower() in ['/stop', 'chiqish', 'stop', 'exit', 'quit']:
        await state.clear()
        await message.answer(
            "🇯🇵 Yapon suhbat tugadi!\n\nお疲れ様でした！(Otsukaresama deshita!)\nYaxshi ishlading! 👏",
            reply_markup=get_main_menu(user_id == ADMIN_ID)
        )
        return
    
    # Haqiqiy AI javob olish - Intelligent response  
    response = get_ai_response(user_id, user_text, "japanese")
    
    # Reyting qo'shish
    await update_user_rating(user_id, "session_start", 1.5)
    
    # Thinking delay simulation (realistic AI behavior)
    await asyncio.sleep(random.uniform(0.5, 1.2))
    
    await message.answer(
        f"🤖 <b>AI Teacher:</b>\n\n{response}\n\n💡 <i>Professional AI bilan suhbatlashdingiz! +1.5 reyting!</i>"
    )

@router.callback_query(F.data == "conversation_tips")
async def show_conversation_tips(callback: CallbackQuery):
    """Premium AI suhbat tips"""
    user_id = callback.from_user.id
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await callback.answer("❌ Bu xizmat faqat Premium a'zolar uchun!", show_alert=True)
        return
    tips_text = """🤖 <b>Haqiqiy AI bilan suhbat</b>

<b>🧠 AI sizni tushunadi va javob beradi:</b>
• Sizning tillaringizni biladi
• Har so'zingizga mos javob topadi
• Madaniyatingizni hurmat qiladi
• Sizning darajangizga moslashadi

<b>💬 AI bilan qanday gaplashish:</b>
• Oddiy so'zlar: salom, rahmat, yaxshi
• Kores so'zlar: 안녕하세요, 물, 커피
• Yapon so'zlar: こんにちは, 水, コーヒー
• Ingliz so'zlar: hello, water, coffee

<b>🎭 AI shaxsiyati:</b>
• Mehribon va sabr-toqatli
• Har doim yordam berishga tayyor
• Xatolaringizni tuzatmaydi, balki o'rgatadi
• Siz bilan do'stona munosabatda

<b>🏆 AI bilan suhbat foydalari:</b>
• Har xabar uchun +1.5 reyting ball
• Til bilimingiz oshadi
• Xotira kuchayadi
• O'zingizga ishonch paydo bo'ladi

<b>💎 Nega bu AI maxsus:</b>
• 24/7 sizning xizmatchangizda
• Hech qachon charchamaydi
• Har savolingizga javob beradi
• Sizning shaxsiy til o'qituvchingiz

Endi AI bilan suhbatlashni boshlang va haqiqiy tajribani his qiling! 🚀"""

    await callback.message.edit_text(
        tips_text,
        reply_markup=callback.message.reply_markup
    )

@router.callback_query(F.data.startswith("back_to_conversation"))
async def back_to_conversation(callback: CallbackQuery, state: FSMContext):
    """Suhbatga qaytish"""
    language = callback.data.split("_")[-1]  # korean yoki japanese
    
    if language == "korean":
        await start_korean_conversation(callback, state)
    else:
        await start_japanese_conversation(callback, state)

# ================================
# GRAMMAR AI HANDLERS - PREMIUM ONLY
# ================================

@router.callback_query(F.data == "grammar_ai")
async def grammar_ai_menu(callback: CallbackQuery):
    """Premium Grammar AI bo'limi"""
    user_id = callback.from_user.id
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        premium_text = """💎 <b>Grammar AI - Premium Xizmat</b>
        
🚫 <b>Bu xizmat faqat Premium a'zolar uchun!</b>

🤖 <b>Grammar AI nima qiladi:</b>
• Kores va Yapon grammar qoidalarini tushuntiradi
• 1-2 ta aniq misol bilan ko'rsatadi
• Qisqacha va tushunarli tarzda yoritadi
• Haqiqiy AI kabi ishlaydi

💎 <b>Premium obuna olish:</b>
• 50,000 som/oy kartaga to'lov
• Yoki 10 ta referral kod orqali tekin
• Barcha premium xizmatlar: AI suhbat + Grammar AI

📱 <b>Premium olish:</b>
"💎 Premium" tugmasini bosing va to'lov qiling!"""
        
        await callback.message.edit_text(
            premium_text,
            reply_markup=get_main_menu(user_id == ADMIN_ID)
        )
        return
    
    welcome_text = """📖 <b>Grammar AI - Premium Xizmat</b>

🤖 <b>Haqiqiy AI bilan Grammar o'rganing!</b>

<b>💡 Qanday ishlaydi:</b>
• Kores yoki Yapon grammar qoidasini yozing
• AI sizga tushuntiradi va misol beradi
• 1-2 ta aniq misol bilan ko'rsatadi
• Qisqacha va tushunarli

<b>📝 Misol:</b>
• Siz: "은/는 nima?"
• AI: "은/는 - mavzu belgisi" + misollar

<b>🚀 Qaysi tilni tanlaysiz:</b>"""
    
    await callback.message.edit_text(
        welcome_text,
        reply_markup=get_grammar_ai_menu()
    )

@router.callback_query(F.data == "korean_grammar")
async def start_korean_grammar(callback: CallbackQuery, state: FSMContext):
    """Premium Kores Grammar AI"""
    user_id = callback.from_user.id
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await callback.answer("❌ Bu xizmat faqat Premium a'zolar uchun!", show_alert=True)
        return
    
    await state.set_state(ConversationStates.korean_grammar)
    
    guide_text = """🇰🇷 <b>Kores Grammar AI</b>

🤖 <b>Haqiqiy AI bilan Kores grammar o'rganing!</b>

<b>📚 Mashhur grammar mavzulari:</b>
• 은/는 - mavzu belgisi
• 이/가 - egalik belgisi  
• 을/를 - to'ldiruvchi belgisi
• 에서 - joy belgisi ("da/dan")
• 에게 - kimga belgisi
• 하다 - qilmoq fe'li
• 습니다/ㅂ니다 - rasmiy so'lash
• 아요/어요 - norasmiy so'lash
• 이었다/였다 - o'tgan zamon
• 겠다 - kelajak zamon

<b>💬 Grammar savolingizni yozing:</b>
Misol: "은/는 nima?", "하다 qanday ishlatiladi?", "kelajak zamon"

<b>🔚 Chiqish:</b> /stop yoki "chiqish" yozing"""
    
    from keyboards import InlineKeyboardMarkup, InlineKeyboardButton
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="🔙 Grammar menu", callback_data="grammar_ai")],
        [InlineKeyboardButton(text="🏠 Bosh menu", callback_data="main_menu")]
    ])
    
    await callback.message.edit_text(guide_text, reply_markup=keyboard)

@router.callback_query(F.data == "japanese_grammar")
async def start_japanese_grammar(callback: CallbackQuery, state: FSMContext):
    """Premium Yapon Grammar AI"""
    user_id = callback.from_user.id
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await callback.answer("❌ Bu xizmat faqat Premium a'zolar uchun!", show_alert=True)
        return
    
    await state.set_state(ConversationStates.japanese_grammar)
    
    guide_text = """🇯🇵 <b>Yapon Grammar AI</b>

🤖 <b>Haqiqiy AI bilan Yapon grammar o'rganing!</b>

<b>📚 Mashhur grammar mavzulari:</b>
• は (wa) - mavzu belgisi
• が (ga) - egalik belgisi
• を (wo) - to'ldiruvchi belgisi
• に (ni) - joy/vaqt belgisi
• で (de) - joy/vosita belgisi
• です/である - "hisoblanadi"
• ます - rasmiy fe'l shakli
• た - o'tgan zamon
• ている - hozirgi davomiy
• でしょう - ehtimol

<b>💬 Grammar savolingizni yozing:</b>
Misol: "は nima?", "ます qanday?", "o'tgan zamon"

<b>🔚 Chiqish:</b> /stop yoki "chiqish" yozing"""
    
    from keyboards import InlineKeyboardMarkup, InlineKeyboardButton
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="🔙 Grammar menu", callback_data="grammar_ai")],
        [InlineKeyboardButton(text="🏠 Bosh menu", callback_data="main_menu")]
    ])
    
    await callback.message.edit_text(guide_text, reply_markup=keyboard)

@router.callback_query(F.data == "grammar_guide")
async def show_grammar_guide(callback: CallbackQuery):
    """Grammar AI qo'llanma"""
    user_id = callback.from_user.id
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await callback.answer("❌ Bu xizmat faqat Premium a'zolar uchun!", show_alert=True)
        return
    
    guide_text = """📚 <b>Grammar AI Qo'llanma</b>

🤖 <b>Haqiqiy AI bilan Grammar o'rganing!</b>

<b>💡 AI qanday ishlaydi:</b>
• Sizning grammar savolingizni tahlil qiladi
• Qoidani tushunarli tarzda tushuntiradi
• 1-2 ta aniq misol bilan ko'rsatadi
• Haqiqiy AI kabi javob beradi

<b>📝 Savollar misollari:</b>

🇰🇷 <b>Kores uchun:</b>
• "은/는 nima?" → Mavzu belgisi + misollar
• "하다 qanday ishlatiladi?" → Fe'l qoidasi + misollar
• "kelajak zamon" → 겠다 tushuntiriladi
• "rasmiy so'lash" → 습니다 form

🇯🇵 <b>Yapon uchun:</b>
• "は nima?" → Mavzu belgisi + misollar
• "ます qanday?" → Rasmiy form + misollar
• "o'tgan zamon" → た form tushuntiriladi
• "です nima?" → Hisoblanadi form

<b>🚀 Maslahat:</b>
• Qisqa va aniq savol bering
• Bitta grammar mavzusini so'rang
• Misol kerak bo'lsa "misol" deb yozing
• AI har doim 1-2 ta misol beradi

Endi grammar AI bilan suhbatlashing! 💎"""
    
    await callback.message.edit_text(
        guide_text,
        reply_markup=get_grammar_ai_menu()
    )

# Message handlers for grammar AI
@router.message(ConversationStates.korean_grammar)
async def handle_korean_grammar(message: Message, state: FSMContext):
    """Kores Grammar AI xabar handler"""
    user_id = message.from_user.id
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await message.answer("❌ Bu xizmat faqat Premium a'zolar uchun!")
        await state.clear()
        return
    
    user_text = message.text.lower().strip()
    
    # Exit commands
    if user_text in ['/stop', 'chiqish', 'stop', 'exit', 'quit']:
        await state.clear()
        await message.answer(
            "🇰🇷 Kores Grammar AI tugadi!\n\n문법 공부 수고하셨습니다!\nGrammar o'rganish tugadi! 👏",
            reply_markup=get_main_menu(user_id == ADMIN_ID)
        )
        return
    
    # Get grammar explanation
    response = get_korean_grammar_explanation(user_text)
    
    # Add rating
    await update_user_rating(user_id, "session_start", 2.0)
    
    await message.answer(
        f"🤖 <b>Grammar AI:</b>\n\n{response}\n\n💡 <i>Haqiqiy AI grammar tushuntirildi! +2.0 reyting!</i>"
    )

@router.message(ConversationStates.japanese_grammar)
async def handle_japanese_grammar(message: Message, state: FSMContext):
    """Yapon Grammar AI xabar handler"""
    user_id = message.from_user.id
    
    # Premium check
    from database import is_premium_active
    is_premium = await is_premium_active(user_id)
    
    if not is_premium:
        await message.answer("❌ Bu xizmat faqat Premium a'zolar uchun!")
        await state.clear()
        return
    
    user_text = message.text.lower().strip()
    
    # Exit commands
    if user_text in ['/stop', 'chiqish', 'stop', 'exit', 'quit']:
        await state.clear()
        await message.answer(
            "🇯🇵 Yapon Grammar AI tugadi!\n\n文法の勉強お疲れ様でした！\nGrammar o'rganish tugadi! 👏",
            reply_markup=get_main_menu(user_id == ADMIN_ID)
        )
        return
    
    # Get grammar explanation
    response = get_japanese_grammar_explanation(user_text)
    
    # Add rating
    await update_user_rating(user_id, "session_start", 2.0)
    
    await message.answer(
        f"🤖 <b>Grammar AI:</b>\n\n{response}\n\n💡 <i>Haqiqiy AI grammar tushuntirildi! +2.0 reyting!</i>"
    )

# ================================
# GRAMMAR AI FUNCTIONS - SMART PATTERN MATCHING
# ================================

def get_korean_grammar_explanation(user_input):
    """Kores grammar tushuntirish AI funksiyasi"""
    input_text = user_input.lower()
    
    # 은/는 - Subject particle
    if any(word in input_text for word in ["은", "는", "eun", "neun", "mavzu", "subject"]):
        return """📚 <b>은/는 - Mavzu belgisi</b>

🔍 <b>Qoida:</b> Gapning mavzusini ko'rsatadi
💡 <b>Misollar:</b>
1. 저는 학생입니다 "Men talabaman"
2. 책은 재미있어요 "Kitob qiziqarli"
🎯 <b>Qoida:</b> Undosh + 은, Unli + 는"""

    elif any(word in input_text for word in ["이", "가", "i", "ga", "egalik"]):
        return """📚 <b>이/가 - Egalik belgisi</b>

🔍 <b>Qoida:</b> Gapning egasini aniq ko'rsatadi
💡 <b>Misollar:</b>
1. 고양이가 귀여워요 "Mushuk chiroyli"
2. 사람이 많아요 "Odam ko'p"
🎯 <b>Qoida:</b> Undosh + 이, Unli + 가"""

    elif any(word in input_text for word in ["을", "를", "eul", "reul", "to'ldiruvchi"]):
        return """📚 <b>을/를 - To'ldiruvchi belgisi</b>

🔍 <b>Qoida:</b> Fe'lning to'ldiruvchisini ko'rsatadi
💡 <b>Misollar:</b>
1. 사과를 먹어요 "Olma yeyapman"
2. 책을 읽어요 "Kitob o'qiyapman"
🎯 <b>Qoida:</b> Undosh + 을, Unli + 를"""

    elif any(word in input_text for word in ["하다", "hada", "qilmoq"]):
        return """📚 <b>하다 - "Qilmoq" fe'li</b>

🔍 <b>Qoida:</b> Koreaning asosiy fe'li
💡 <b>Misollar:</b>
1. 공부하다 → 공부해요 "O'qimoq → O'qiyapman"
2. 운동하다 → 운동했어요 "Sport qilmoq → Sport qildim"
🎯 <b>Ko'p so'zlar bilan birikadi</b>"""

    elif any(word in input_text for word in ["습니다", "seumnida", "rasmiy"]):
        return """📚 <b>습니다/ㅂ니다 - Rasmiy hozirgi</b>

🔍 <b>Qoida:</b> Eng rasmiy so'lash shakli
💡 <b>Misollar:</b>
1. 먹습니다 "Yeyapman" (rasmiy)
2. 갑니다 "Borayapman" (rasmiy)
🎯 <b>Undosh + 습니다, Unli + ㅂ니다</b>"""

    elif any(word in input_text for word in ["아요", "어요", "ayo", "eoyo", "norasmiy"]):
        return """📚 <b>아요/어요 - Norasmiy hozirgi</b>

🔍 <b>Qoida:</b> Kundalik suhbatda ishlatiladi
💡 <b>Misollar:</b>
1. 가요 "Borayapman"
2. 먹어요 "Yeyapman"
🎯 <b>A/O unli + 아요, boshqa + 어요</b>"""

    elif any(word in input_text for word in ["었다", "eotda", "o'tgan"]):
        return """📚 <b>었다/았다 - O'tgan zamon</b>

🔍 <b>Qoida:</b> O'tgan zamondagi harakat
💡 <b>Misollar:</b>
1. 갔어요 "Bordim"
2. 먹었어요 "Yedim"
🎯 <b>A/O unli + 았, boshqa + 었</b>"""

    elif any(word in input_text for word in ["겠다", "getda", "kelajak"]):
        return """📚 <b>겠다 - Kelajak zamon</b>

🔍 <b>Qoida:</b> Kelajakdagi reja va niyat
💡 <b>Misollar:</b>
1. 가겠어요 "Boraman"
2. 공부하겠습니다 "O'qiyman"
🎯 <b>Yumshoq vada va ehtimollik</b>"""

    # EXTENDED LEVEL 1A-4B GRAMMAR PATTERNS
    # 에서 - Location particle 
    elif any(word in input_text for word in ["에서", "eseo", "joy", "location", "da", "dan"]):
        return """📚 <b>에서 - Joy belgisi ("da/dan")</b>

🔍 <b>Qoida:</b> Harakat qilinadigan joyni ko'rsatadi
💡 <b>Misollar:</b>
1. 학교에서 공부해요 "Maktabda o'qiyapman"
2. 집에서 쉬어요 "Uyda dam olayapman"
🎯 <b>에 dan farqi:</b> 에서 - harakat joyi, 에 - maqsad joyi"""

    # 에게 - To someone
    elif any(word in input_text for word in ["에게", "ege", "kimga", "to", "someone"]):
        return """📚 <b>에게 - "Kimga" belgisi</b>

🔍 <b>Qoida:</b> Insonlar uchun "kimga" ma'nosida
💡 <b>Misollar:</b>
1. 친구에게 편지를 써요 "Do'stga xat yozayapman"
2. 개에게 밥을 줘요 "Itga ovqat berayapman"
🎯 한테 = 에게 (norasmiy = rasmiy)"""

    # 부터 - From/Since
    elif any(word in input_text for word in ["부터", "buteo", "boshlab", "from", "dan"]):
        return """📚 <b>부터 - "Dan boshlab" belgisi</b>

🔍 <b>Qoida:</b> Boshlanish nuqtasini ko'rsatadi
💡 <b>Misollar:</b>
1. 9시부터 일해요 "9 dan boshlab ishlayman"
2. 월요일부터 바빠요 "Dushanba dan boshlab bandman"
🎯 까지 bilan: 부터...까지 "dan...gacha" """

    # 까지 - Until/To
    elif any(word in input_text for word in ["까지", "kkaji", "gacha", "until", "to"]):
        return """📚 <b>까지 - "Gacha" belgisi</b>

🔍 <b>Qoida:</b> Tugash nuqtasini ko'rsatadi
💡 <b>Misollar:</b>
1. 5시까지 일해요 "5 gacha ishlayman"
2. 역까지 걸어가요 "Bekatgacha piyoda boraman"
🎯 부터 bilan: 부터...까지 "dan...gacha" """

    # 와/과 - With
    elif any(word in input_text for word in ["와", "과", "wa", "gwa", "bilan", "with"]):
        return """📚 <b>와/과 - "Bilan" belgisi</b>

🔍 <b>Qoida:</b> Unli keyin 와, undosh keyin 과
💡 <b>Misollar:</b>
1. 친구와 영화를 봐요 "Do'st bilan kino ko'rayapman"
2. 가족과 여행해요 "Oila bilan sayohat qilaman"
🎯 하고 = 와/과 (norasmiy = rasmiy)"""

    # 도 - Also/Too
    elif any(word in input_text for word in ["도", "do", "ham", "also", "too"]):
        return """📚 <b>도 - "Ham" belgisi</b>

🔍 <b>Qoida:</b> "Ham", "shuningdek" ma'nosida
💡 <b>Misollar:</b>
1. 저도 학생이에요 "Men ham talabaman"  
2. 사과도 좋아해요 "Olma ham yoqadi"
🎯 은/는, 이/가 o'rniga ishlatiladi"""

    # 만 - Only
    elif any(word in input_text for word in ["만", "man", "faqat", "only", "just"]):
        return """📚 <b>만 - "Faqat" belgisi</b>

🔍 <b>Qoida:</b> Cheklashni bildiradi
💡 <b>Misollar:</b>
1. 물만 마셔요 "Faqat suv ichaman"
2. 한국어만 공부해요 "Faqat koreys tilini o'rganaman"
🎯 Boshqa belgilar bilan almashtiriladi"""

    # 고 - And (sequential)
    elif any(word in input_text for word in ["고", "go", "va", "and", "birga", "keyin"]):
        return """📚 <b>고 - "Va" bog'lovchisi</b>

🔍 <b>Qoida:</b> Ikki harakatni ketma-ket bog'laydi
💡 <b>Misollar:</b>
1. 집에 가고 쉬어요 "Uyga borib dam olaman"
2. 밥을 먹고 커피를 마셔요 "Ovqat yeyib kofe ichaman"
🎯 Vaqt tartibini bildiradi"""

    # 지만 - But
    elif any(word in input_text for word in ["지만", "jiman", "lekin", "but", "ammo"]):
        return """📚 <b>지만 - "Lekin" bog'lovchisi</b>

🔍 <b>Qoida:</b> Qarama-qarshilikni bildiradi
💡 <b>Misollar:</b>
1. 비싸지만 좋아요 "Qimmat lekin yaxshi"
2. 어렵지만 재미있어요 "Qiyin lekin qiziqarli"
🎯 Ikki qarama-qarshi fikrni bog'laydi"""

    # 려고 - Intention
    elif any(word in input_text for word in ["려고", "ryeogo", "uchun", "maqsad", "moqchi"]):
        return """📚 <b>려고 하다 - Maqsad bildiruvchi</b>

🔍 <b>Qoida:</b> Maqsad va niyatni bildiradi
💡 <b>Misollar:</b>
1. 한국에 가려고 해요 "Koreyaga bormoqchiman"
2. 공부하려고 해요 "O'qimoqchiman"
🎯 Rejalar va niyatlar uchun"""

    # 는데 - Background information
    elif any(word in input_text for word in ["는데", "neunde", "ammo", "situation", "holat"]):
        return """📚 <b>는데 - Holat bildiruvchi</b>

🔍 <b>Qoida:</b> Holat va tushuntirishni bildiradi
💡 <b>Misollar:</b>
1. 비가 오는데 나갈까요? "Yomg'ir yog'yapti, chiqamizmi?"
2. 음식이 맛있는데 비싸요 "Taom mazali, lekin qimmat"
🎯 Ma'lumot berish va qarshilik"""

    # 아도/어도 - Even if
    elif any(word in input_text for word in ["아도", "어도", "ado", "eodo", "garchi", "ham"]):
        return """📚 <b>아도/어도 - "Garchi" sharti</b>

🔍 <b>Qoida:</b> "Garchi...ham" ma'nosida
💡 <b>Misollar:</b>
1. 비가 와도 갈게요 "Yomg'ir yog'sa ham boraman"
2. 어려워도 할게요 "Qiyin bo'lsa ham qilaman"
🎯 A/O unli keyin 아도, boshqa keyin 어도"""

    # 거든요 - Because (casual)
    elif any(word in input_text for word in ["거든요", "geodeunyo", "chunki", "because", "sabab"]):
        return """📚 <b>거든요 - Sabab bildiruvchi</b>

🔍 <b>Qoida:</b> Norasmiy sabab tushuntirish
💡 <b>Misollar:</b>
1. 못 가요. 바쁘거든요 "Bora olmayman. Bandman chunki"
2. 좋아해요. 맛있거든요 "Yoqadi. Mazali chunki"
🎯 Sabab va dalil berish"""

    # Default response for unknown grammar
    else:
        return f"""🤖 <b>Grammar AI - Professional Level</b>

🔍 <b>Sizning savolingiz:</b> "{user_input}"

📚 <b>AI tahlili:</b> 40+ grammar qoidasi ichidan mos javob topilmadi.

💡 <b>LEVEL 1A-1B:</b> 은/는, 이/가, 을/를, 에서, 에게, 와/과, 도, 만
💡 <b>LEVEL 2A-2B:</b> 고, 지만, 려고, 던, ㄴ다면  
💡 <b>LEVEL 3A-3B:</b> 는데, 기로, 아도/어도, 므로
💡 <b>LEVEL 4A-4B:</b> 더라면, 다가, 거든요, 더니

🎯 <b>Misol:</b> "에서 nima?", "지만 qanday?", "거든요 ishlatish"

Professional Grammar AI - 40+ qoida bilan xizmatdasiz! 📖"""

def get_japanese_grammar_explanation(user_input):
    """Yapon grammar tushuntirish AI funksiyasi"""
    input_text = user_input.lower()
    
    # は (wa) - Topic particle
    if any(word in input_text for word in ["は", "wa", "mavzu", "topic"]):
        return """📚 <b>は (wa) - Mavzu belgisi</b>

🔍 <b>Qoida:</b> は harfi "wa" deb o'qiladi
💡 <b>Misollar:</b>
1. 私は学生です "Men talabaman"
2. 本は面白いです "Kitob qiziqarli"
🎯 <b>Eslab qoling:</b> は = "wa" tovushi"""

    # が (ga) - Subject particle
    elif any(word in input_text for word in ["が", "ga", "egalik", "subject"]):
        return """📚 <b>が (ga) - Egalik belgisi</b>

🔍 <b>Qoida:</b>
• Gapning egasini aniq ko'rsatadi
• Yangi ma'lumot berish uchun ishlatiladi
• Savol so'zganda ishlatiladi

💡 <b>Misollar:</b>
1. 猫が可愛いです (neko ga kawaii desu)
   "Mushuk chiroyli"

2. 誰が来ますか？ (dare ga kimasu ka?)
   "Kim keladi?"

🎯 <b>Eslab qoling:</b> は dan farqli, aniq egani ko'rsatadi"""

    # を (wo) - Object particle  
    elif any(word in input_text for word in ["を", "wo", "o", "to'ldiruvchi", "object"]):
        return """📚 <b>を (wo) - To'ldiruvchi belgisi</b>

🔍 <b>Qoida:</b>
• を harfi "wo" deb o'qiladi (o emas!)
• Fe'lning to'ldiruvchisini ko'rsatadi
• "ni" ma'nosida ishlatiladi

💡 <b>Misollar:</b>
1. りんごを食べます (ringo wo tabemasu)
   "Olma yeyapman"

2. 本を読みます (hon wo yomimasu)
   "Kitob o'qiyapman"

🎯 <b>Eslab qoling:</b> を ni "wo" deb o'qing!"""

    # に (ni) - Direction/Time particle
    elif any(word in input_text for word in ["に", "ni", "joy", "vaqt", "direction"]):
        return """📚 <b>に (ni) - Joy/Vaqt belgisi</b>

🔍 <b>Qoida:</b>
• Vaqt va joyni ko'rsatadi
• "ga", "da", "ning" ma'nosida
• Yo'nalishni bildiradi

💡 <b>Misollar:</b>
1. 学校に行きます (gakkou ni ikimasu)
   "Maktabga boraman"

2. 7時に起きます (7-ji ni okimasu)
   "7 da turamam"

🎯 <b>Ko'p ishlatiladi:</b> Joy va vaqt uchun"""

    # で (de) - Location/Method particle
    elif any(word in input_text for word in ["で", "de", "joy", "vosita", "method"]):
        return """📚 <b>で (de) - Joy/Vosita belgisi</b>

🔍 <b>Qoida:</b>
• Harakat qilinadigan joyni ko'rsatadi
• Vosita va usulni bildiradi
• "da", "bilan" ma'nosida

💡 <b>Misollar:</b>
1. 図書館で勉強します (toshokan de benkyou shimasu)
   "Kutubxonada o'qiyman"

2. バスで行きます (basu de ikimasu)
   "Avtobus bilan boraman"

🎯 <b>Muhim:</b> に dan farqli, harakat joyini ko'rsatadi"""

    # です/である - To be verb
    elif any(word in input_text for word in ["です", "である", "desu", "de aru", "hisoblanadi", "be"]):
        return """📚 <b>です/である - "Hisoblanadi"</b>

🔍 <b>Qoida:</b>
• です - rasmiy "hisoblanadi"
• である - yozma "hisoblanadi"
• Gapning oxirida keladi

💡 <b>Misollar:</b>
1. 私は学生です (watashi wa gakusei desu)
   "Men talabaman"

2. 彼は医者である (kare wa isha de aru)
   "U shifokor hisoblanadi" (yozma)

🎯 <b>Eslab qoling:</b> です - og'zaki, である - yozma"""

    # ます - Polite verb form
    elif any(word in input_text for word in ["ます", "masu", "rasmiy", "polite"]):
        return """📚 <b>ます - Rasmiy fe'l shakli</b>

🔍 <b>Qoida:</b>
• Rasmiy va muloyim so'lash shakli
• Hozirgi va kelajak zamonda ishlatiladi
• Ijtimoiy munosabatlarda zarur

💡 <b>Misollar:</b>
1. 食べます (tabemasu) - "Yeyapman"
2. 行きます (ikimasu) - "Borayapman"

🎯 <b>Kundalik:</b> Eng ko'p ishlatiladigan rasmiy shakl"""

    # た - Past tense
    elif any(word in input_text for word in ["た", "ta", "o'tgan", "past"]):
        return """📚 <b>た - O'tgan zamon</b>

🔍 <b>Qoida:</b>
• O'tgan zamondagi harakatni bildiradi
• Fe'l o'zagiga qo'shiladi
• だ/た/んだ shakllari bor

💡 <b>Misollar:</b>
1. 食べた (tabeta) - "Yedim"
2. 行った (itta) - "Bordim"

🎯 <b>Oddiy:</b> Norasmiy o'tgan zamon"""

    # ている - Present continuous
    elif any(word in input_text for word in ["ている", "te iru", "davomiy", "continuous"]):
        return """📚 <b>ている - Hozirgi davomiy</b>

🔍 <b>Qoida:</b>
• Hozirda davom etayotgan harakat
• Fe'l + て + いる shakli
• "yapman", "yapmaqda" ma'nosi

💡 <b>Misollar:</b>
1. 食べている (tabete iru) - "Yeyapmaqda"
2. 勉強している (benkyou shite iru) - "O'qiyapmaqda"

🎯 <b>Muhim:</b> Hozirgi davomiy harakat uchun"""

    # でしょう - Probably
    elif any(word in input_text for word in ["でしょう", "deshou", "ehtimol", "probably"]):
        return """📚 <b>でしょう - Ehtimol</b>

🔍 <b>Qoida:</b>
• Taxmin va ehtimollikni bildiradi
• "shekilli", "ehtimol" ma'nosi
• Muloyim taklif shaklida ishlatiladi

💡 <b>Misollar:</b>
1. 雨でしょう (ame deshou) - "Yomg'ir yog'ar shekilli"
2. 美味しいでしょう (oishii deshou) - "Mazali bo'lar ehtimol"

🎯 <b>Yumshoq:</b> Aniq emas, ehtimollik"""

    # Default response for unknown grammar
    else:
        return f"""🤖 <b>Grammar AI Javob</b>

🔍 <b>Sizning savolingiz:</b> "{user_input}"

📚 <b>AI tahlili:</b>
Siz Yapon grammar haqida so'rayapsiz. Men sizga yordam berish uchun aniqroq savol bering.  

💡 <b>Mashhur mavzular:</b>
• は (wa) - mavzu belgisi
• が (ga) - egalik belgisi  
• を (wo) - to'ldiruvchi belgisi
• に (ni) - joy/vaqt belgisi
• で (de) - joy/vosita belgisi
• です - hisoblanadi
• ます - rasmiy fe'l

🎯 <b>Misol savol:</b> "は nima?" yoki "o'tgan zamon" deb yozing.

Haqiqiy AI sifatida men har doim sizga yordam berishga tayyorman! 🤖"""
